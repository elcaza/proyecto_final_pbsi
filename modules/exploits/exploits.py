from base64 import b64decode
import os

class Exploit():
    def __init__(self, parametros):
        self.set_nombre(parametros)
        self.set_contenido(parametros)
        self.set_software(parametros)
        self.set_biblioteca(parametros)
        self.set_gestor_contenido(parametros)
        self.get_extension()
        self.get_ruta()

    def crear_archivo_exploit(self):
        with open(self.ruta+"/"+self.nombre,"wb") as archivo_exploit:
            archivo_exploit.write(b64decode(self.contenido))
        return True

    def get_extension(self):
        self.extension = self.nombre.split(".")
        if len(self.extension) == 1:
            self.extension = ""
            return self.extension
        self.extension = self.extension[-1]
        return self.extension

    def get_nombre(self):
        return self.nombre
    
    def get_contenido(self):
        return self.contenido

    def get_software(self):
        return self.software
        
    def get_biblioteca(self):
        return self.biblioteca

    def get_gestor_contenido(self):
        return self.gestor_contenido

    def get_ruta(self):
        self.ruta = os.path.join(os.path.dirname(os.path.dirname(os.path.abspath(os.path.dirname(__file__)))),"files")
        return self.ruta 

    def set_nombre(self,parametros):
        if "nombre" in parametros:
                self.nombre = parametros["nombre"]
        else:
            self.nombre = "exploit_generico.sh"
    
    def set_contenido(self,parametros):
        if "contenido" in parametros:
                self.contenido = parametros["contenido"]
        else:
            self.contenido = "ZWNobyAiRXhpdG8i"

    def set_software(self,parametros):
        if "software" in parametros:
                self.software = parametros["software"]
        else:
            self.software = "Generico"
        
    def set_biblioteca(self,parametros):
        if "biblioteca" in parametros:
                self.biblioteca = parametros["biblioteca"]
        else:
            self.biblioteca = "Generico"

    def set_gestor_contenido(self,parametros):
        if "gestor_contenido" in parametros:
                self.gestor_contenido = parametros["gestor_contenido"]
        else:
            self.gestor_contenido = "Generico"

    def cargar_datos_mongo(self):
        return {"nombre":self.nombre,"ruta":self.ruta,"software":self.software,"biblioteca":self.biblioteca,"gestor_contenido":self.gestor_contenido}

def execute(parametros):
    exploit = Exploit(parametros)
    exploit.crear_archivo_exploit()
    return exploit.cargar_datos_mongo()

#con = Conector()
#con.exploit_cargar_datos(execute("exploit1.py","aG9sYSBqYWphaiBlcyBhdW5zZGFzbGRtIHFtMzQtaTEzeWU4Zy1kaXAyaDM0MjB7b2RueyAKcHJ1ZWJh","Javascript","Math",""))